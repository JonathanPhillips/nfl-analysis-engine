<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ team.team_name }} - NFL Analysis Engine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        :root {
            --nfl-blue: #013369;
            --nfl-red: #D50A0A;
            --nfl-silver: #A5ACAF;
        }
        
        body {
            background-color: #f8f9fa;
        }
        
        .team-header {
            background: linear-gradient(135deg, var(--nfl-blue), var(--nfl-red));
            color: white;
            padding: 2rem 0;
        }
        
        .team-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--nfl-blue);
        }
        
        .win-percentage {
            font-size: 2rem;
            font-weight: bold;
            color: var(--nfl-blue);
        }
        
        .game-result {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 5px;
        }
        
        .game-result.win {
            background-color: #d4edda;
            border-left: 3px solid #28a745;
        }
        
        .game-result.loss {
            background-color: #f8d7da;
            border-left: 3px solid #dc3545;
        }
        
        .upcoming-game {
            background-color: #fff3cd;
            border-left: 3px solid #ffc107;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: var(--nfl-blue) !important;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="/web/">
                <i class="bi bi-trophy-fill"></i> NFL Analysis Engine
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/web/">Dashboard</a>
                <a class="nav-link" href="/web/teams">Teams</a>
                <a class="nav-link" href="/web/games">Games</a>
                <a class="nav-link" href="/web/players">Players</a>
                <a class="nav-link" href="/web/predictions">Predictions</a>
                <a class="nav-link" href="/web/insights">Insights</a>
            </div>
        </div>
    </nav>

    <div class="team-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-auto">
                    {% if team.team_logo_espn %}
                    <img src="{{ team.team_logo_espn }}" alt="{{ team.team_name }} logo" class="team-logo">
                    {% else %}
                    <div class="team-logo bg-light rounded d-flex align-items-center justify-content-center">
                        <span class="h3 text-dark mb-0">{{ team.team_abbr }}</span>
                    </div>
                    {% endif %}
                </div>
                <div class="col">
                    <h1 class="mb-0">{{ team.team_name }}</h1>
                    <h5 class="text-light mb-0">{{ team.team_conf }} {{ team.team_division }}</h5>
                </div>
                <div class="col-auto text-end">
                    <div class="win-percentage text-white">
                        {{ "%.1f"|format(win_percentage * 100) }}%
                    </div>
                    <small class="text-light">Win Rate</small>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <div class="row">
            <!-- Team Statistics -->
            <div class="col-md-4">
                <div class="stat-card">
                    <h5><i class="bi bi-bar-chart-line"></i> Season Statistics</h5>
                    <hr>
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="h4 text-success mb-0">{{ wins }}</div>
                            <small class="text-muted">Wins</small>
                        </div>
                        <div class="col-4">
                            <div class="h4 text-danger mb-0">{{ losses }}</div>
                            <small class="text-muted">Losses</small>
                        </div>
                        <div class="col-4">
                            <div class="h4 text-primary mb-0">{{ wins + losses }}</div>
                            <small class="text-muted">Played</small>
                        </div>
                    </div>
                </div>
                
                {% if upcoming_games %}
                <div class="stat-card">
                    <h5><i class="bi bi-calendar-event"></i> Upcoming Games</h5>
                    <hr>
                    {% for game in upcoming_games[:3] %}
                    <div class="upcoming-game game-result">
                        <div class="row align-items-center">
                            <div class="col">
                                <strong>
                                    {% if game.home_team == team.team_abbr %}
                                        vs {{ game.away_team }}
                                    {% else %}
                                        @ {{ game.home_team }}
                                    {% endif %}
                                </strong>
                                <br>
                                <small class="text-muted">{{ game.game_date.strftime("%b %d, %Y") }}</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Recent Games -->
            <div class="col-md-8">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5><i class="bi bi-clock-history"></i> Recent Games</h5>
                        <a href="/web/games?team={{ team.team_abbr }}" class="btn btn-outline-primary btn-sm">
                            View All Games
                        </a>
                    </div>
                    
                    {% if recent_games %}
                    {% for game in recent_games %}
                    <div class="game-result {% if (game.home_team == team.team_abbr and game.home_score > game.away_score) or (game.away_team == team.team_abbr and game.away_score > game.home_score) %}win{% else %}loss{% endif %}" 
                         onclick="window.location.href='/web/game/{{ game.game_id }}'" style="cursor: pointer;">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <strong>{{ game.game_date.strftime("%b %d") }}</strong>
                                <br>
                                <small class="text-muted">Week {{ game.week or 'N/A' }}</small>
                            </div>
                            <div class="col-md-6">
                                {% if game.home_team == team.team_abbr %}
                                    <strong>{{ team.team_abbr }}</strong> vs {{ game.away_team }}
                                {% else %}
                                    <strong>{{ team.team_abbr }}</strong> @ {{ game.home_team }}
                                {% endif %}
                                <br>
                                <small class="text-muted">
                                    {% if game.home_score is not none and game.away_score is not none %}
                                        Final: {{ game.home_score }} - {{ game.away_score }}
                                    {% else %}
                                        Score not available
                                    {% endif %}
                                </small>
                            </div>
                            <div class="col-md-3 text-end">
                                {% if game.home_score is not none and game.away_score is not none %}
                                    {% if (game.home_team == team.team_abbr and game.home_score > game.away_score) or (game.away_team == team.team_abbr and game.away_score > game.home_score) %}
                                        <span class="badge bg-success">W</span>
                                        <div class="small">
                                            {% if game.home_team == team.team_abbr %}
                                                +{{ game.home_score - game.away_score }}
                                            {% else %}
                                                +{{ game.away_score - game.home_score }}
                                            {% endif %}
                                        </div>
                                    {% else %}
                                        <span class="badge bg-danger">L</span>
                                        <div class="small">
                                            {% if game.home_team == team.team_abbr %}
                                                -{{ game.away_score - game.home_score }}
                                            {% else %}
                                                -{{ game.home_score - game.away_score }}
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-calendar-x display-4"></i>
                        <p class="mt-2">No recent games found for this team.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Team Roster -->
        {% if roster_players %}
        <div class="row mt-4">
            <div class="col-12">
                <div class="stat-card">
                    <h5><i class="bi bi-people-fill"></i> Current Roster</h5>
                    <hr>
                    
                    <!-- Position Groups -->
                    <div class="row">
                        {% if roster_by_position %}
                        {% for position_group, players in roster_by_position.items() %}
                        <div class="col-lg-4 mb-4">
                            <h6 class="text-primary text-uppercase fw-bold">{{ position_group }}</h6>
                            <div class="position-group">
                                {% for player in players %}
                                <div class="player-row mb-2 p-2 rounded" style="background: #f8f9fa; cursor: pointer;" onclick="window.location.href='/web/player/{{ player.player_id }}'">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            {% if player.jersey_number %}
                                            <span class="badge bg-primary">#{{ player.jersey_number }}</span>
                                            {% else %}
                                            <span class="badge bg-secondary">#--</span>
                                            {% endif %}
                                        </div>
                                        <div class="col">
                                            <div class="fw-bold">{{ player.full_name }}</div>
                                            <small class="text-muted">
                                                {{ player.position or 'N/A' }}
                                                {% if player.age %} • {{ player.age }}y{% endif %}
                                                {% if player.college %} • {{ player.college }}{% endif %}
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <!-- Simple roster list when no position grouping -->
                        <div class="col-12">
                            <div class="row g-3">
                                {% for player in roster_players[:20] %}
                                <div class="col-md-6 col-lg-4">
                                    <div class="player-card p-3 rounded" style="background: #f8f9fa; cursor: pointer; transition: background 0.2s;" 
                                         onmouseover="this.style.background='#e9ecef'" 
                                         onmouseout="this.style.background='#f8f9fa'"
                                         onclick="window.location.href='/web/player/{{ player.player_id }}'">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3">
                                                {% if player.jersey_number %}
                                                <span class="badge bg-primary fs-6">#{{ player.jersey_number }}</span>
                                                {% else %}
                                                <span class="badge bg-secondary fs-6">#--</span>
                                                {% endif %}
                                            </div>
                                            <div class="flex-grow-1">
                                                <div class="fw-bold">{{ player.full_name }}</div>
                                                <small class="text-muted">
                                                    {{ player.position or 'N/A' }}
                                                    {% if player.years_exp is not none %} • {{ player.years_exp }}y exp{% endif %}
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                
                                {% if roster_players|length > 20 %}
                                <div class="col-12 text-center mt-3">
                                    <a href="/web/players?team={{ team.team_abbr }}" class="btn btn-outline-primary">
                                        View All {{ roster_players|length }} Players
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <!-- No Roster Data -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="stat-card">
                    <h5><i class="bi bi-people-fill"></i> Team Roster</h5>
                    <hr>
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-people-fill display-4"></i>
                        <h6 class="mt-2">Roster Data Loading</h6>
                        <p class="mb-3">Player roster information is being processed and will be available soon.</p>
                        <a href="/web/players?team={{ team.team_abbr }}" class="btn btn-outline-primary">
                            <i class="bi bi-search me-1"></i>Search Team Players
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Team Analysis Links -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="stat-card">
                    <h5><i class="bi bi-graph-up"></i> Advanced Analytics</h5>
                    <hr>
                    <div class="row">
                        <div class="col-md-3">
                            <a href="/web/insights/team/{{ team.team_abbr }}/2024" class="btn btn-outline-primary w-100 mb-2">
                                <i class="bi bi-lightbulb"></i> Team Insights
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="/web/insights/compare?team1={{ team.team_abbr }}" class="btn btn-outline-secondary w-100 mb-2">
                                <i class="bi bi-arrows-angle-contract"></i> Compare Teams
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="/web/predict?home_team={{ team.team_abbr }}" class="btn btn-outline-success w-100 mb-2">
                                <i class="bi bi-graph-up-arrow"></i> Predict Games
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="/web/games?season=2024&team={{ team.team_abbr }}" class="btn btn-outline-info w-100 mb-2">
                                <i class="bi bi-calendar-check"></i> Full Schedule
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-light py-4 mt-5">
        <div class="container text-center">
            <p class="text-muted mb-0">
                &copy; 2024 NFL Analysis Engine. Built with FastAPI and Bootstrap.
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>